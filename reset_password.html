<!DOCTYPE html>
<html>
<head>
    <title>Reset Password</title>
    <style>
        body { font-family: sans-serif; }
        .container { width: 300px; margin: 50px auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Imposta Nuova Password</h1>
        <p>Inserisci la tua nuova password qui sotto.</p>
        <form id="resetPasswordForm">
            <label for="newPassword">Nuova Password:</label><br>
            <input type="password" id="newPassword" required><br><br>
            <label for="confirmNewPassword">Conferma Nuova Password:</label><br>
            <input type="password" id="confirmNewPassword" required><br><br>
            <button type="submit">Aggiorna Password</button>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="script.js"></script> <script>
        // Logica specifica per la pagina di reset
        document.getElementById('resetPasswordForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const newPassword = document.getElementById('newPassword').value;
            const confirmNewPassword = document.getElementById('confirmNewPassword').value;

            if (newPassword !== confirmNewPassword) {
                alert('Errore: Le password non corrispondono.');
                return;
            }

            try {
                // Supabase rileva automaticamente il token di reset dall'URL
                const { error } = await supabase.auth.updateUser({
                    password: newPassword
                });

                if (error) throw error;

                alert('Password aggiornata con successo! Ora puoi accedere.');
                window.location.href = '/login.html';

            } catch (error) {
                console.error('Errore nel reset password:', error.message);
                alert('Errore durante l\'aggiornamento della password. Assicurati che il link non sia scaduto.');
            }
        });
    </script>
</body>
</html>
